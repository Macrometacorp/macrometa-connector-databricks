/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Scala application project to get you started.
 * For more details take a look at the 'Building Java & JVM projects' chapter in the Gradle
 * User Manual available at https://docs.gradle.org/8.0.2/userguide/building_java_projects.html
 */

plugins {
    // Apply the scala Plugin to add support for Scala.
    id 'scala'
    id 'com.github.johnrengelman.shadow' version '7.1.2'
    // Apply the application plugin to add support for building a CLI application in Java.
    id 'application'
    id 'maven-publish'
}

publishing {
    repositories {
        maven {
            name = "GitHubPackages"
            url = uri("https://maven.pkg.github.com/Macrometacorp/macrometa-connector-databricks")
            credentials {
                username = System.getenv("GITHUB_ACTOR")
                password = System.getenv("GITHUB_TOKEN")
            }
        }
    }
    publications {
        shadow(MavenPublication) { publication ->
            from project.shadow.component(publication)
            artifactId = 'macrometa-connector-databricks-shadow'
            artifact(tasks.shadowJar) {
                builtBy tasks.shadowJar
            }
        }
    }
}

repositories {
    // Use Maven Central for resolving dependencies.
    mavenCentral()
}
shadowJar {
    archiveBaseName.set('macrometa-connector-databricks')
    archiveClassifier.set('')
    relocate 'com.typesafe.config', 'shaded.com.typesafe.config'
    relocate 'shapeless', 'shaded.shapeless'

    manifest {
        attributes 'Main-Class': 'com.macrometa.spark.App'
    }
    zip64 true
    dependencies {
        exclude(dependency("org.scala-lang:scala-library:2.12.10"))
    }
}

dependencies {
    def scalaVersion = '2.12.14'
    def AkkaVersion = '2.6.16'
    def AkkaHttpVersion = '10.2.6'
    def circeVersion = '0.14.0-M1'
    def sparkVersion = '3.3.0'
    def slf4jVersion = '1.7.32'
    def log4jVersion = '2.14.1'

    def shapelessVersion = '2.3.3' // Set the Shapeless version
    implementation "com.chuusai:shapeless_2.12:$shapelessVersion"
    implementation "org.scala-lang:scala-library:$scalaVersion"

    implementation("org.apache.spark:spark-sql_2.12:$sparkVersion") {
        exclude group: 'log4j'
        exclude group: 'org.slf4j', module: 'slf4j-log4j12'
    }
    implementation 'com.typesafe:config:1.2.1'
    implementation "com.typesafe.akka:akka-actor-typed_2.12:$AkkaVersion"
    implementation "com.typesafe.akka:akka-stream_2.12:$AkkaVersion"
    implementation "com.typesafe.akka:akka-http_2.12:$AkkaHttpVersion"
    implementation ("io.circe:circe-core_2.12:$circeVersion")
    implementation 'org.typelevel:cats-kernel_2.12:2.1.1'
    implementation "io.circe:circe-generic_2.12:$circeVersion"
    implementation "io.circe:circe-parser_2.12:$circeVersion"
    implementation "org.slf4j:slf4j-api:$slf4jVersion"
    implementation "org.apache.logging.log4j:log4j-api:$log4jVersion"
    implementation "org.apache.logging.log4j:log4j-core:$log4jVersion"
    implementation "org.apache.logging.log4j:log4j-1.2-api:$log4jVersion"
    implementation "org.apache.logging.log4j:log4j-slf4j-impl:$log4jVersion"
    implementation "org.apache.pulsar:pulsar-client:2.9.1"
    // Add the following test dependencies
    testImplementation group: 'org.scalatest', name: 'scalatest_2.12', version: '3.2.9'
    testImplementation group: 'org.scalatestplus', name: 'scalatestplus-junit_2.12', version: '1.0.0-M2'
    testImplementation group: 'junit', name: 'junit', version: '4.13.2'
}
sourceSets {
    main {
        resources {
            srcDirs = ["src/main/resources"]
        }
    }
}


application {
    // Define the main class for the application.
    mainClass = 'com.macrometa.spark.App'
}

def void exclude(LinkedHashMap<String, String> stringStringLinkedHashMap) {}
